{% extends "base.html" %}
{% block title %}IP WHOIS{% endblock %}
{% block content %}
<div class="card-tool">
    <div class="tool-header">
        <h1 class="tool-title">ðŸ“œ IP WHOIS</h1>
        <p class="tool-description">Consulta informaciÃ³n de registro de una direcciÃ³n IP</p>
    </div>
    <div class="input-group-modern">
        <input type="text" id="ipInput" placeholder="Ejemplo: 8.8.8.8" onkeypress="if(event.key==='Enter') lookupWhois()">
        <button onclick="lookupWhois()" class="btn-gradient"><i class="bi bi-search"></i> Consultar</button>
    </div>
    <div id="loader" class="loader-container"><div class="spinner"></div><p style="color: var(--text-secondary);">Consultando...</p></div>
    <div id="error" class="alert-modern alert-error"></div>
    <div id="results" class="alert-modern alert-success"></div>
</div>
<script>
async function lookupWhois() {
    const ip = document.getElementById('ipInput').value.trim();
    const loader = document.getElementById('loader');
    const errorDiv = document.getElementById('error');
    const resultsDiv = document.getElementById('results');
    if (!ip) { errorDiv.innerHTML = '<strong><i class="bi bi-exclamation-triangle"></i> Error:</strong> Ingresa una IP'; errorDiv.classList.add('active'); return; }
    loader.classList.add('active'); errorDiv.classList.remove('active'); resultsDiv.classList.remove('active');
    try {
        const fd = new FormData(); fd.append('ip', ip);
        const r = await fetch('/api/ip-whois', {method: 'POST', body: fd});
        const d = await r.json();
        if (d.success) {
            let h = '<h4><i class="bi bi-check-circle"></i> WHOIS para <code>' + ip + '</code></h4><table class="results-table"><tbody>';
            for (const [k, v] of Object.entries(d.data)) {
                let val = Array.isArray(v) ? v.join('<br>') : v;
                h += '<tr><td><strong>' + k.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) + '</strong></td><td>' + val + '</td></tr>';
            }
            h += '</tbody></table>';
            resultsDiv.innerHTML = h; resultsDiv.classList.add('active');
        } else { errorDiv.innerHTML = '<strong><i class="bi bi-exclamation-triangle"></i> Error:</strong> ' + d.error; errorDiv.classList.add('active'); }
    } catch (e) { errorDiv.innerHTML = '<strong><i class="bi bi-exclamation-triangle"></i> Error:</strong> ConexiÃ³n fallida'; errorDiv.classList.add('active'); }
    finally { loader.classList.remove('active'); }
}
</script>
{% endblock %}
