{% extends "base.html" %}
{% block title %}Comprimir Imagen{% endblock %}

{% block extra_styles %}
<style>
.tool-page { background: white; min-height: calc(100vh - 200px); padding: 3rem 0; }
.tool-header { text-align: center; margin-bottom: 3rem; }
.tool-header h1 { font-size: 2.5rem; font-weight: 700; color: #2c3e50; margin-bottom: 0.5rem; }
.tool-header p { font-size: 1.1rem; color: #7f8c8d; }
.upload-area { background: #fff; border: 2px dashed #ddd; border-radius: 12px; padding: 4rem 2rem; text-align: center; cursor: pointer; transition: all 0.3s; max-width: 600px; margin: 0 auto; }
.upload-area:hover { border-color: #fd79a8; background: #fef5f9; }
.upload-icon { font-size: 4rem; color: #fd79a8; margin-bottom: 1rem; }
.upload-text { font-size: 1.3rem; font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem; }
.upload-hint { color: #7f8c8d; font-size: 0.95rem; }
.btn-main { background: #fd79a8; color: white; border: none; padding: 1rem 3rem; border-radius: 8px; font-size: 1.1rem; font-weight: 600; transition: all 0.3s; display: block; margin: 2rem auto; }
.btn-main:hover { background: #e056a0; transform: translateY(-2px); color: white; }
</style>
{% endblock %}

{% block content %}
<div class="tool-page">
    <div class="container">
        <div class="tool-header">
            <h1>Comprimir Imagen</h1>
            <p>Reduce el tama√±o de tus im√°genes sin perder calidad</p>
        </div>
        <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
            <input type="file" id="fileInput" accept="image/*" style="display: none">
            <div class="upload-icon">üé®</div>
            <div class="upload-text">Seleccionar imagen</div>
            <div class="upload-hint">JPG, PNG, WEBP, GIF</div>
            <div id="fileName" class="mt-3 text-muted"></div>
        </div>
        <button class="btn-main" id="compressBtn" disabled onclick="compress()">Comprimir Imagen</button>
    </div>
</div>
<script>
let file=null;const dropZone=document.getElementById('dropZone'),fileInput=document.getElementById('fileInput'),fileName=document.getElementById('fileName'),compressBtn=document.getElementById('compressBtn');
dropZone.ondragover=e=>{e.preventDefault();dropZone.style.borderColor='#fd79a8'};
dropZone.ondragleave=()=>dropZone.style.borderColor='#ddd';
dropZone.ondrop=e=>{e.preventDefault();dropZone.style.borderColor='#ddd';handleFile(e.dataTransfer.files[0])};
fileInput.onchange=e=>handleFile(e.target.files[0]);
function handleFile(f){if(!f||!f.type.startsWith('image/')){alert('Solo im√°genes');return}file=f;fileName.textContent=`üñºÔ∏è ${f.name}`;compressBtn.disabled=false}
async function compress(){if(!file)return;compressBtn.disabled=true;compressBtn.innerHTML='<span class="spinner-border spinner-border-sm"></span> Comprimiendo...';const fd=new FormData();fd.append('file',file);fd.append('level','normal');try{const r=await fetch('/api/compress-image',{method:'POST',body:fd});if(r.ok){const blob=await r.blob();const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`comprimida_${file.name}`;a.click();URL.revokeObjectURL(url)}else alert('Error')}catch(e){alert('Error: '+e)}finally{compressBtn.disabled=false;compressBtn.innerHTML='Comprimir Imagen'}}
</script>
{% endblock %}