{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width: 900px; margin: 50px auto;">
  <div class="card-tool">
    <div class="text-center mb-4">
      <h1 class="tool-header-gradient">SPF Check</h1>
      <p class="text-secondary">Verifica el registro SPF.</p>
    </div>

    
<div class="lookup-section">
  <div class="input-group">
    <input type="text" id="input" class="form-control" placeholder="Introduce dominio o IP...">
    <button onclick="runTool()" class="btn btn-gradient">Consultar</button>
  </div>
</div>


    <div id="loader" class="text-center p-4" style="display:none;">
      <div class="spinner-border text-primary"></div>
      <p class="mt-2">Procesando...</p>
    </div>

    <div id="results" class="mt-4" style="display:none;"></div>
    <div id="error" class="alert alert-danger mt-4" style="display:none;"></div>
  </div>
</div>

<script>

async function runTool() {
    const val = document.getElementById("input").value.trim();
    const loader = document.getElementById("loader");
    const results = document.getElementById("results");
    const errorDiv = document.getElementById("error");

    if (!val) { showError("Por favor, introduce un valor v√°lido."); return; }

    loader.style.display = 'block';
    results.style.display = 'none';
    errorDiv.style.display = 'none';

    try {
        const formData = new FormData();
        formData.append('value', val);

        const res = await fetch('/api/spf_check', { method: 'POST', body: formData });
        const data = await res.json();

        if (data.success) {
            results.innerHTML = '<pre class="bg-light p-3 rounded">'+JSON.stringify(data.data, null, 2)+'</pre>';
            results.style.display = 'block';
        } else {
            showError(data.error || "Error desconocido.");
        }
    } catch (err) {
        showError("Error de red o servidor.");
    } finally {
        loader.style.display = 'none';
    }
}

function showError(msg) {
    const e = document.getElementById("error");
    e.textContent = msg;
    e.style.display = 'block';
}

</script>

<style>
.card-tool {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 40px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}
.tool-header-gradient {
  font-weight: 700;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.btn-gradient {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  color: white;
}
.btn-gradient:hover { opacity: 0.9; }
.table { color: var(--text-primary); }
</style>
{% endblock %}
