{% extends "base.html" %}
{% block title %}Email Header Analyzer{% endblock %}
{% block extra_styles %}
<style>
.tool-page{background:white;min-height:calc(100vh-200px);padding:3rem 0}
.tool-header{text-align:center;margin-bottom:2rem;max-width:800px;margin:0 auto}
.tool-header h1{font-size:2.5rem;font-weight:700;color:#2c3e50;margin-bottom:1rem}
.tool-description{font-size:1.1rem;color:#7f8c8d;line-height:1.6;margin-bottom:1.5rem}
.tool-features{background:#f8f9fa;padding:1.5rem;border-radius:10px;text-align:left}
.input-card{max-width:700px;margin:2rem auto;background:white;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
textarea{width:100%;padding:1rem;border:2px solid #e9ecef;border-radius:8px;font-family:monospace;font-size:0.9rem}
.btn-main{background:#74b9ff;color:white;border:none;padding:0.9rem 2rem;border-radius:8px;font-weight:600;cursor:pointer;width:100%;margin-top:1rem}
.results-card{max-width:900px;margin:2rem auto;background:white;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
</style>
{% endblock %}
{% block content %}
<div class="tool-page"><div class="container">
<div class="tool-header">
<h1>✉️ Email Header Analyzer</h1>
<p class="tool-description">Analiza los headers completos de un email para rastrear su origen, verificar autenticación SPF/DKIM y detectar posibles problemas.</p>
<div class="tool-features"><h3>Características:</h3><ul>
<li>Extrae IP de origen</li><li>Verifica SPF y DKIM</li><li>Muestra ruta del email</li><li>Detecta anomalías</li>
</ul></div>
</div>
<div class="input-card">
<label class="form-label fw-bold">Pega los headers completos del email:</label>
<textarea id="headers" rows="12" placeholder="Received: from..."></textarea>
<button class="btn-main" onclick="check()">Analizar Headers</button>
<div id="loader" class="text-center py-4" style="display:none"><div class="spinner-border mb-2"></div></div>
<div id="error" class="alert alert-danger mt-3" style="display:none"></div>
</div>
<div id="results" style="display:none"><div class="results-card"><h5 class="mb-3">Análisis:</h5><div id="resultsContent"></div></div></div>
</div></div>
<script>
async function check(){const h=document.getElementById('headers').value.trim();if(!h){document.getElementById('error').textContent='Pega los headers';document.getElementById('error').style.display='block';return}document.getElementById('loader').style.display='block';document.getElementById('error').style.display='none';document.getElementById('results').style.display='none';try{const fd=new FormData();fd.append('headers',h);const r=await fetch('/api/email-header',{method:'POST',body:fd});const data=await r.json();if(data.success){let html='<div class="row g-3 mb-3"><div class="col-md-6"><div class="card"><div class="card-body"><h6>IP Origen:</h6><code>'+(data.origin_ip_guess||'-')+'</code></div></div></div><div class="col-md-6"><div class="card"><div class="card-body"><h6>SPF:</h6><span class="badge '+(data.spf_result==='pass'?'bg-success':'bg-danger')+'">'+(data.spf_result||'-')+'</span></div></div></div></div>';if(data.received?.length)html+='<h6 class="mt-3">Received Headers:</h6><pre class="p-3 bg-light rounded small">'+data.received.map(x=>x.replace(/</g,'&lt;')).join('\n')+'</pre>';document.getElementById('resultsContent').innerHTML=html;document.getElementById('results').style.display='block'}else{document.getElementById('error').textContent=data.error;document.getElementById('error').style.display='block'}}catch(e){document.getElementById('error').textContent='Error';document.getElementById('error').style.display='block'}finally{document.getElementById('loader').style.display='none'}}
</script>
{% endblock %}